box: wercker/ubuntu12.04-nodejs0.10@0.0.4
build:
  steps:
    - script:
        name: echo nodejs information
        code: |
            node -v
            npm -v
    - npm-install
    - script:
        name: run application and test
        code: |
            npm start &
            echo "Server started"
            npm test
    - script:
        name: clone jscoverage
        code: |
            git clone git://github.com/visionmedia/node-jscoverage
    - script:
        name: install jscoverage
        code: |
            cd jscoverage
            ./configure
            make
            make install
    - script:
        name: calculate test efficacy
        code: |
            export APERCU_COVERAGE=1
            ./node_modules/bin/mocha test -R mocha-lcov-reporter | ./node_modules/coveralls/bin/coveralls.js

